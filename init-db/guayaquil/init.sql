CREATE EXTENSION IF NOT EXISTS postgres_fdw;

-- 1. Crear ÚNICAMENTE las tablas que residen FÍSICAMENTE en Guayaquil
CREATE TABLE info_empleados_guayaquil (empleado_cedula VARCHAR PRIMARY KEY, nombre VARCHAR, ciudad_id INT);
CREATE TABLE rol_empleados_guayaquil (empleado_cedula VARCHAR PRIMARY KEY REFERENCES info_empleados_guayaquil(empleado_cedula), rol VARCHAR);
CREATE TABLE info_clientes_guayaquil (cedula VARCHAR PRIMARY KEY, nombre VARCHAR, ciudad_id INT);
CREATE TABLE telefono_clientes_guayaquil (cedula VARCHAR PRIMARY KEY REFERENCES info_clientes_guayaquil(cedula), telefono VARCHAR);
CREATE TABLE correo_clientes_guayaquil (cedula VARCHAR PRIMARY KEY REFERENCES info_clientes_guayaquil(cedula), correo VARCHAR);
CREATE TABLE inventario_guayaquil (inventario_id INT PRIMARY KEY, producto_id INT, ciudad_id INT, stock INT);

-- LÓGICA PARA IDs DE ORDEN PERSONALIZADOS EN GUAYAQUIL
CREATE SEQUENCE orden_guayaquil_seq START 1;
CREATE OR REPLACE FUNCTION generar_id_orden_guayaquil()
RETURNS VARCHAR AS $$
BEGIN
    RETURN 'OG-' || nextval('orden_guayaquil_seq');
END;
$$ LANGUAGE plpgsql;

CREATE TABLE ordenes_trabajo_guayaquil (
    orden_id VARCHAR(20) PRIMARY KEY DEFAULT generar_id_orden_guayaquil(),
    cliente_cedula VARCHAR,
    placa VARCHAR,
    fecha DATE,
    estado VARCHAR,
    ciudad_id INT,
    empleado_cedula VARCHAR, -- Cambiado a cédula
    form_pago_id INT
);

-- 2. Insertar datos ÚNICAMENTE en los fragmentos de Guayaquil
INSERT INTO info_empleados_guayaquil (empleado_cedula, nombre, ciudad_id) VALUES ('0900000001','Juan Alvear',2),('0900000002','Karla Briones',2),('0900000003','Luis Cedeño',2),('0900000004','Marcela Delgado',2),('0900000005','Nicolás Estrada',2),('0900000006','Ofelia Franco',2),('0900000007','Pedro Garcés',2),('0900000008','Rita Holguín',2),('0900000009','Simón Intriago',2),('0900000010','Teresa Jurado',2),('0900000011','Ulises Krause',2),('0900000012','Victoria Lino',2),('0900000013','Walter Macías',2),('0900000014','Xiomara Navarrete',2),('0900000015','Yandri Oñate',2),('0900000016','Zoila Pin',2),('0900000017','Antonio Quijije',2),('0900000018','Berta Ronquillo',2),('0900000019','Clemente Suárez',2),('0900000020','Dolores Triviño',2),('0900000021','Efrén Urrutia',2),('0900000022','Fanny Vera',2),('0900000023','Galo Wong',2),('0900000024','Helena Ycaza',2),('0900000025','Ismael Zambrano',2),('0900000026','Juana Álava',2),('0900000027','Kléber Bowen',2),('0900000028','Liliana Castro',2),('0900000029','Manuel Dueñas',2),('0900000030','Nelly Escobar',2);
INSERT INTO rol_empleados_guayaquil (empleado_cedula, rol) VALUES ('0900000001','Gerente de Sucursal'),('0900000002','Asesora de Servicio'),('0900000003','Mecánico Jefe'),('0900000004','Asesora de Servicio'),('0900000005','Mecánico A'),('0900000006','Recepcionista'),('0900000007','Mecánico B'),('0900000008','Contadora'),('0900000009','Mecánico C'),('0900000010','Jefa de Repuestos'),('0900000011','Mecánico A'),('0900000012','Asistente Administrativa'),('0900000013','Mecánico B'),('0900000014','Cajera'),('0900000015','Mecánico A'),('0900000016','Asesora de Servicio'),('0900000017','Mecánico C'),('0900000018','Pasante Mecánica'),('0900000019','Bodeguero'),('0900000020','Personal de Limpieza'),('0900000021','Mecánico B'),('0900000022','Asesora de Servicio'),('0900000023','Mecánico A'),('0900000024','Recepcionista'),('0900000025','Mecánico C'),('0900000026','Cajera'),('0900000027','Mecánico B'),('0900000028','Asistente Contable'),('0900000029','Bodeguero'),('0900000030','Mecánico A');
INSERT INTO info_clientes_guayaquil (cedula, nombre, ciudad_id) VALUES ('0912345678','Carlos Mendoza',2),('0923456789','Diana Ponce',2),('0934567890','Ernesto Quiroz',2),('0945678901','Fernanda Rosado',2),('0956789012','Gabriel Solís',2),('0967890123','Hilda Torres',2),('0978901234','Iván Ugarte',2),('0989012345','Jimena Villao',2),('0990123456','Kevin Wolf',2),('0901234567','Lorena Yagual',2),('0911223344','Mario Zumba',2),('0922334455','Nora Anchundia',2),('0933445566','Óscar Baquerizo',2),('0944556677','Patricia Cajas',2),('0955667788','Roberto Delgado',2),('0966778899','Silvana Estupiñán',2),('0977889900','Tomás Figueroa',2),('0988990011','Úrsula Gómez',2),('0999001122','Vicente Herrera',2),('0900112233','Wendy Icaza',2),('0912131415','Xavier Jarrín',2),('0923242526','Yajaira Kronfle',2),('0934353637','Zulema Litardo',2),('0945464748','Alfonso Mejía',2),('0956575859','Betty Naranjo',2),('0967686970','César Orellana',2),('0978798081','Dunia Palacios',2),('0989809192','Edison Quinteros',2),('0990910203','Fabiola Rendón',2),('0901021314','Gregorio Sánchez',2);
INSERT INTO telefono_clientes_guayaquil (cedula, telefono) VALUES ('0912345678','0987654321'),('0923456789','0998765432'),('0934567890','0976543210'),('0945678901','0965432109'),('0956789012','0954321098'),('0967890123','0943210987'),('0978901234','0932109876'),('0989012345','0921098765'),('0990123456','0910987654'),('0901234567','0909876543'),('0911223344','0911223344'),('0922334455','0922334455'),('0933445566','0933445566'),('0944556677','0944556677'),('0955667788','0955667788'),('0966778899','0966778899'),('0977889900','0977889900'),('0988990011','0988990011'),('0999001122','0999001122'),('0900112233','0900112233'),('0912131415','0912131415'),('0923242526','0923242526'),('0934353637','0934353637'),('0945464748','0945464748'),('0956575859','0956575859'),('0967686970','0967686970'),('0978798081','0978798081'),('0989809192','0989809192'),('0990910203','0990910203'),('0901021314','0901021314');
INSERT INTO correo_clientes_guayaquil (cedula, correo) VALUES ('0912345678','carlos.m@mail.com'),('0923456789','diana.p@mail.com'),('0934567890','ernesto.q@mail.com'),('0945678901','fernanda.r@mail.com'),('0956789012','gabriel.s@mail.com'),('0967890123','hilda.t@mail.com'),('0978901234','ivan.u@mail.com'),('0989012345','jimena.v@mail.com'),('0990123456','kevin.w@mail.com'),('0901234567','lorena.y@mail.com'),('0911223344','mario.z@mail.com'),('0922334455','nora.a@mail.com'),('0933445566','oscar.b@mail.com'),('0944556677','patricia.c@mail.com'),('0955667788','roberto.d@mail.com'),('0966778899','silvana.e@mail.com'),('0977889900','tomas.f@mail.com'),('0988990011','ursula.g@mail.com'),('0999001122','vicente.h@mail.com'),('0900112233','wendy.i@mail.com'),('0912131415','xavier.j@mail.com'),('0923242526','yajaira.k@mail.com'),('0934353637','zulema.l@mail.com'),('0945464748','alfonso.m@mail.com'),('0956575859','betty.n@mail.com'),('0967686970','cesar.o@mail.com'),('0978798081','dunia.p@mail.com'),('0989809192','edison.q@mail.com'),('0990910203','fabiola.r@mail.com'),('0901021314','gregorio.s@mail.com');
INSERT INTO inventario_guayaquil (inventario_id, producto_id, ciudad_id, stock) VALUES (31,1,2,60),(32,2,2,150),(33,3,2,100),(34,4,2,250),(35,5,2,50),(36,6,2,50),(37,7,2,40),(38,8,2,20),(39,9,2,80),(40,10,2,90),(41,11,2,30),(42,12,2,30),(43,13,2,80),(44,14,2,12),(45,15,2,20),(46,16,2,25),(47,17,2,40),(48,18,2,10),(49,19,2,8),(50,20,2,10),(51,21,2,40),(52,22,2,35),(53,23,2,200),(54,24,2,50),(55,25,2,15),(56,26,2,20),(57,27,2,15),(58,28,2,60),(59,29,2,30),(60,30,2,20);
INSERT INTO ordenes_trabajo_guayaquil (cliente_cedula, placa, fecha, estado, ciudad_id, empleado_cedula, form_pago_id) VALUES ('0912345678','GBA-0201','2024-07-01','Finalizada',2,'0900000002',2),('0923456789','GBA-0202','2024-07-01','Finalizada',2,'0900000004',1),('0934567890','GBA-0203','2024-07-02','En Proceso',2,'0900000016',3),('0945678901','GBA-0204','2024-07-03','Finalizada',2,'0900000002',1),('0956789012','GBA-0205','2024-07-04','Recibida',2,'0900000004',2),('0967890123','GBA-0206','2024-07-04','Finalizada',2,'0900000016',1),('0978901234','GBA-0207','2024-07-05','Finalizada',2,'0900000002',3),('0989012345','GBA-0208','2024-07-06','En Proceso',2,'0900000004',1),('0990123456','GBA-0209','2024-07-06','Finalizada',2,'0900000016',2),('0901234567','GBA-0210','2024-07-07','Recibida',2,'0900000002',3),('0911223344','GBA-0211','2024-07-08','Finalizada',2,'0900000004',1),('0922334455','GBA-0212','2024-07-08','En Proceso',2,'0900000016',2),('0933445566','GBA-0213','2024-07-09','Finalizada',2,'0900000002',1),('0944556677','GBA-0214','2024-07-10','Finalizada',2,'0900000004',3),('0955667788','GBA-0215','2024-07-11','Recibida',2,'0900000016',2),('0966778899','GBA-0216','2024-07-12','En Proceso',2,'0900000002',1),('0977889900','GBA-0217','2024-07-13','Finalizada',2,'0900000004',1),('0988990011','GBA-0218','2024-07-13','Finalizada',2,'0900000016',2),('0999001122','GBA-0219','2024-07-14','Recibida',2,'0900000002',3),('0900112233','GBA-0220','2024-07-15','En Proceso',2,'0900000004',1),('0912131415','GBA-0221','2024-07-16','Finalizada',2,'0900000016',2),('0923242526','GBA-0222','2024-07-17','Finalizada',2,'0900000002',1),('0934353637','GBA-0223','2024-07-18','Recibida',2,'0900000004',3),('0945464748','GBA-0224','2024-07-19','Finalizada',2,'0900000016',1),('0956575859','GBA-0225','2024-07-20','En Proceso',2,'0900000002',2),('0967686970','GBA-0226','2024-07-21','Finalizada',2,'0900000004',1),('0978798081','GBA-0227','2024-07-22','Recibida',2,'0900000016',3),('0989809192','GBA-0228','2024-07-23','Finalizada',2,'0900000002',2),('0990910203','GBA-0229','2024-07-24','En Proceso',2,'0900000004',1),('0901021314','GBA-0230','2024-07-25','Finalizada',2,'0900000016',1);

-- 3. Crear vista local para clientes completos
CREATE OR REPLACE VIEW v_clientes_completos_guayaquil AS
SELECT i.cedula, i.nombre, t.telefono, c.correo, i.ciudad_id
FROM info_clientes_guayaquil i
JOIN telefono_clientes_guayaquil t ON i.cedula = t.cedula
JOIN correo_clientes_guayaquil c ON i.cedula = c.cedula;