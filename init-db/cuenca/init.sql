CREATE EXTENSION IF NOT EXISTS postgres_fdw;

-- 1. Crear ÚNICAMENTE las tablas que residen FÍSICAMENTE en Cuenca
CREATE TABLE info_empleados_cuenca (empleado_cedula VARCHAR PRIMARY KEY, nombre VARCHAR, ciudad_id INT);
CREATE TABLE rol_empleados_cuenca (empleado_cedula VARCHAR PRIMARY KEY REFERENCES info_empleados_cuenca(empleado_cedula), rol VARCHAR);
CREATE TABLE info_clientes_cuenca (cedula VARCHAR PRIMARY KEY, nombre VARCHAR, ciudad_id INT);
CREATE TABLE telefono_clientes_cuenca (cedula VARCHAR PRIMARY KEY REFERENCES info_clientes_cuenca(cedula), telefono VARCHAR);
CREATE TABLE correo_clientes_cuenca (cedula VARCHAR PRIMARY KEY REFERENCES info_clientes_cuenca(cedula), correo VARCHAR);
CREATE TABLE inventario_cuenca (inventario_id INT PRIMARY KEY, producto_id INT, ciudad_id INT, stock INT);

-- LÓGICA PARA IDs DE ORDEN PERSONALIZADOS EN CUENCA
CREATE SEQUENCE orden_cuenca_seq START 1;
CREATE OR REPLACE FUNCTION generar_id_orden_cuenca()
RETURNS VARCHAR AS $$
BEGIN
    RETURN 'OC-' || nextval('orden_cuenca_seq');
END;
$$ LANGUAGE plpgsql;

CREATE TABLE ordenes_trabajo_cuenca (
    orden_id VARCHAR(20) PRIMARY KEY DEFAULT generar_id_orden_cuenca(),
    cliente_cedula VARCHAR,
    placa VARCHAR,
    fecha DATE,
    estado VARCHAR,
    ciudad_id INT,
    empleado_cedula VARCHAR, -- Cambiado a cédula
    form_pago_id INT
);

-- 2. Insertar datos ÚNICAMENTE en los fragmentos de Cuenca
INSERT INTO info_empleados_cuenca (empleado_cedula, nombre, ciudad_id) VALUES ('0100000001','Alberto Mora',3),('0100000002','Brenda Neira',3),('0100000003','Camilo Ortega',3),('0100000004','Diana Pineda',3),('0100000005','Emilio Quezada',3),('0100000006','Fátima Robles',3),('0100000007','Gonzalo Segovia',3),('0100000008','Heidi Tapia',3),('0100000009','Ignacio Uzcátegui',3),('0100000010','Julieta Vintimilla',3),('0100000011','Kevin Webster',3),('0100000012','Lorena Xavier',3),('0100000013','Marcos Yunga',3),('0100000014','Natalia Zúñiga',3),('0100000015','Omar Astudillo',3),('0100000016','Penélope Bernal',3),('0100000017','Remigio Cabrera',3),('0100000018','Silvia Dávila',3),('0100000019','Teodoro Elizalde',3),('0100000020','Valeria Fajardo',3),('0100000021','Wilson Galarza',3),('0100000022','Ximena Hervas',3),('0100000023','Yamil Iglesias',3),('0100000024','Zoe Jaramillo',3),('0100000025','Adolfo Ledesma',3),('0100000026','Blanca Merchán',3),('0100000027','Cristian Nieto',3),('0100000028','Dora Ocampo',3),('0100000029','Ernesto Pacheco',3),('0100000030','Florencia Quintanilla',3);
INSERT INTO rol_empleados_cuenca (empleado_cedula, rol) VALUES ('0100000001','Mecánico A'),('0100000002','Asesora de Servicio'),('0100000003','Mecánico B'),('0100000004','Cajera'),('0100000005','Mecánico C'),('0100000006','Recepcionista'),('0100000007','Bodeguero'),('0100000008','Asesora de Servicio'),('0100000009','Mecánico A'),('0100000010','Jefa de Taller'),('0100000011','Mecánico B'),('0100000012','Asistente Administrativa'),('0100000013','Mecánico A'),('0100000014','Asesora de Servicio'),('0100000015','Mecánico C'),('0100000016','Pasante Mecánica'),('0100000017','Mecánico A'),('0100000018','Contadora'),('0100000019','Bodeguero'),('0100000020','Asesora de Servicio'),('0100000021','Mecánico B'),('0100000022','Cajera'),('0100000023','Mecánico A'),('0100000024','Recepcionista'),('0100000025','Mecánico C'),('0100000026','Asesora de Servicio'),('0100000027','Mecánico B'),('0100000028','Asistente Contable'),('0100000029','Mecánico A'),('0100000030','Gerente de Sucursal');
INSERT INTO info_clientes_cuenca (cedula, nombre, ciudad_id) VALUES ('0101234567','Adriana Cordero',3),('0102345678','Bolívar Domínguez',3),('0103456789','Cecilia Encalada',3),('0104567890','Diego Feijoo',3),('0105678901','Estefanía Guamán',3),('0106789012','Francisco Hurtado',3),('0107890123','Gisela Izquierdo',3),('0108901234','Hernán Jara',3),('0109012345','Ivonne Loja',3),('0110123456','Javier Malo',3),('0111234567','Katiuska Molina',3),('0112345678','Leonardo Novillo',3),('0113456789','Mireya Ochoa',3),('0114567890','Nelson Pulla',3),('0115678901','Ofelia Quinde',3),('0116789012','Pablo Rivas',3),('0117890123','Quintina Soria',3),('0118901234','Rodrigo Tenorio',3),('0119012345','Sandra Ugalde',3),('0120123456','Tito Vanegas',3),('0121234567','Úrsula Wester',3),('0122345678','Verónica Xavier',3),('0123456789','William Yánez',3),('0124567890','Xavier Zumba',3),('0125678901','Yolanda Andrade',3),('0126789012','Zahir Benavides',3),('0127890123','Amanda Cajas',3),('0128901234','Bruno Coronel',3),('0129012345','Cynthia Durán',3),('0130123456','Danilo Endara',3);
INSERT INTO telefono_clientes_cuenca (cedula, telefono) VALUES ('0101234567','0992345678'),('0102345678','0983456789'),('0103456789','0974567890'),('0104567890','0965678901'),('0105678901','0956789012'),('0106789012','0947890123'),('0107890123','0938901234'),('0108901234','0929012345'),('0109012345','0910123456'),('0110123456','0901234567'),('0111234567','0998765432'),('0112345678','0987654321'),('0113456789','0976543210'),('0114567890','0965432109'),('0115678901','0954321098'),('0116789012','0943210987'),('0117890123','0932109876'),('0118901234','0921098765'),('0119012345','0910987654'),('0120123456','0909876543'),('0121234567','0991112222'),('0122345678','0982223333'),('0123456789','0973334444'),('0124567890','0964445555'),('0125678901','0955556666'),('0126789012','0946667777'),('0127890123','0937778888'),('0128901234','0928889999'),('0129012345','0919990000'),('0130123456','0900001111');
INSERT INTO correo_clientes_cuenca (cedula, correo) VALUES ('0101234567','adriana.c@mail.com'),('0102345678','bolivar.d@mail.com'),('0103456789','cecilia.e@mail.com'),('0104567890','diego.f@mail.com'),('0105678901','estefania.g@mail.com'),('0106789012','francisco.h@mail.com'),('0107890123','gisela.i@mail.com'),('0108901234','hernan.j@mail.com'),('0109012345','ivonne.l@mail.com'),('0110123456','javier.m@mail.com'),('0111234567','katiuska.m@mail.com'),('0112345678','leonardo.n@mail.com'),('0113456789','mireya.o@mail.com'),('0114567890','nelson.p@mail.com'),('0115678901','ofelia.q@mail.com'),('0116789012','pablo.r@mail.com'),('0117890123','quintina.s@mail.com'),('0118901234','rodrigo.t@mail.com'),('0119012345','sandra.u@mail.com'),('0120123456','tito.v@mail.com'),('0121234567','ursula.w@mail.com'),('0122345678','veronica.x@mail.com'),('0123456789','william.y@mail.com'),('0124567890','xavier.z@mail.com'),('0125678901','yolanda.a@mail.com'),('0126789012','zahir.b@mail.com'),('0127890123','amanda.c@mail.com'),('0128901234','bruno.c@mail.com'),('0129012345','cynthia.d@mail.com'),('0130123456','danilo.e@mail.com');
INSERT INTO inventario_cuenca (inventario_id, producto_id, ciudad_id, stock) VALUES (61,1,3,45),(62,2,3,110),(63,3,3,75),(64,4,3,180),(65,5,3,35),(66,6,3,35),(67,7,3,25),(68,8,3,12),(69,9,3,55),(70,10,3,65),(71,11,3,20),(72,12,3,20),(73,13,3,50),(74,14,3,8),(75,15,3,15),(76,16,3,18),(77,17,3,30),(78,18,3,6),(79,19,3,5),(80,20,3,7),(81,21,3,25),(82,22,3,22),(83,23,3,130),(84,24,3,40),(85,25,3,10),(86,26,3,12),(87,27,3,9),(88,28,3,50),(89,29,3,20),(90,30,3,10);
INSERT INTO ordenes_trabajo_cuenca (cliente_cedula, placa, fecha, estado, ciudad_id, empleado_cedula, form_pago_id) VALUES ('0101234567','ABA-0301','2024-06-01','Finalizada',3,'0100000002',1),('0102345678','ABA-0302','2024-06-01','En Proceso',3,'0100000008',2),('0103456789','ABA-0303','2024-06-02','Finalizada',3,'0100000014',3),('0104567890','ABA-0304','2024-06-03','Recibida',3,'0100000002',1),('0105678901','ABA-0305','2024-06-04','Finalizada',3,'0100000008',2),('0106789012','ABA-0306','2024-06-04','En Proceso',3,'0100000014',1),('0107890123','ABA-0307','2024-06-05','Finalizada',3,'0100000002',3),('0108901234','ABA-0308','2024-06-06','Recibida',3,'0100000008',1),('0109012345','ABA-0309','2024-06-06','Finalizada',3,'0100000014',2),('0110123456','ABA-0310','2024-06-07','En Proceso',3,'0100000002',3),('0111234567','ABA-0311','2024-06-08','Finalizada',3,'0100000008',1),('0112345678','ABA-0312','2024-06-08','Recibida',3,'0100000014',2),('0113456789','ABA-0313','2024-06-09','Finalizada',3,'0100000002',1),('0114567890','ABA-0314','2024-06-10','En Proceso',3,'0100000008',3),('0115678901','ABA-0315','2024-06-11','Finalizada',3,'0100000014',2),('0116789012','ABA-0316','2024-06-12','Recibida',3,'0100000002',1),('0117890123','ABA-0317','2024-06-13','Finalizada',3,'0100000008',1),('0118901234','ABA-0318','2024-06-13','En Proceso',3,'0100000014',2),('0119012345','ABA-0319','2024-06-14','Finalizada',3,'0100000002',3),('0120123456','ABA-0320','2024-06-15','Recibida',3,'0100000008',1),('0121234567','ABA-0321','2024-06-16','Finalizada',3,'0100000014',2),('0122345678','ABA-0322','2024-06-17','En Proceso',3,'0100000002',1),('0123456789','ABA-0323','2024-06-18','Finalizada',3,'0100000008',3),('0124567890','ABA-0324','2024-06-19','Recibida',3,'0100000014',1),('0125678901','ABA-0325','2024-06-20','Finalizada',3,'0100000002',2),('0126789012','ABA-0326','2024-06-21','En Proceso',3,'0100000008',1),('0127890123','ABA-0327','2024-06-22','Finalizada',3,'0100000014',3),('0128901234','ABA-0328','2024-06-23','Recibida',3,'0100000002',2),('0129012345','ABA-0329','2024-06-24','Finalizada',3,'0100000008',1),('0130123456','ABA-0330','2024-06-25','En Proceso',3,'0100000014',1);

-- 3. Crear vista local para clientes completos
CREATE OR REPLACE VIEW v_clientes_completos_cuenca AS
SELECT i.cedula, i.nombre, t.telefono, c.correo, i.ciudad_id
FROM info_clientes_cuenca i
JOIN telefono_clientes_cuenca t ON i.cedula = t.cedula
JOIN correo_clientes_cuenca c ON i.cedula = c.cedula;